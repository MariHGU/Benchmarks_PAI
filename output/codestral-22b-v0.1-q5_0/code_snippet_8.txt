SELECT Customers.customer_id, OrderItems.product_id, SUM(OrderItems.quantity) as total_purchased
FROM Orders
JOIN Customers ON Orders.customer_id = Customers.customer_id
JOIN OrderItems ON Orders.order_id = OrderItems.order_id
GROUP BY Customers.customer_id, OrderItems.product_id
ORDER BY COUNT(Orders.order_id) DESC, total_purchased DESC
LIMIT 5;